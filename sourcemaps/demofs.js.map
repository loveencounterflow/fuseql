{"version":3,"sources":["demofs.coffee"],"names":[],"mappings":"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","file":"demofs.js","sourceRoot":"/source/","sourcesContent":["\n\n\n\n############################################################################################################\nnjs_path                  = require 'path'\n# njs_fs                    = require 'fs'\n#...........................................................................................................\nCND                       = require 'cnd'\nrpr                       = CND.rpr.bind CND\nbadge                     = 'FUSEQL/demofs'\nlog                       = CND.get_logger 'plain',   badge\ninfo                      = CND.get_logger 'info',    badge\nalert                     = CND.get_logger 'alert',   badge\ndebug                     = CND.get_logger 'debug',   badge\nwarn                      = CND.get_logger 'warn',    badge\nurge                      = CND.get_logger 'urge',    badge\nwhisper                   = CND.get_logger 'whisper', badge\nhelp                      = CND.get_logger 'help',    badge\necho                      = CND.echo.bind CND\n#...........................................................................................................\n# suspend                   = require 'coffeenode-suspend'\n# step                      = suspend.step\n# immediately               = suspend.immediately\n# after                     = suspend.after\n# sleep                     = suspend.sleep\n#...........................................................................................................\nFUSE                      = require 'fuse-bindings'\nmount_route               = './mnt'\nmount_locator             = njs_path.resolve __dirname, mount_route\n\n\n#-----------------------------------------------------------------------------------------------------------\nmodule.exports = demofs =\n\n  #---------------------------------------------------------------------------------------------------------\n  readdir: ( route, handler ) ->\n    echo \"readdir         #{rpr route}\"\n    if route == '/'\n      filenames = ( \"file-#{idx}\" for idx in [ 0 .. 10 ] )\n      filenames.push 'test'\n      return handler null, filenames\n    handler null\n    return\n\n  #---------------------------------------------------------------------------------------------------------\n  getattr: (route, handler) ->\n    info \"getattr         #{rpr route}\"\n    switch route\n      when '/'\n        handler 0,\n          mtime: new Date\n          atime: new Date\n          ctime: new Date\n          size: 100\n          mode: 16877\n          uid: process.getuid()\n          gid: process.getgid()\n      when '/test'\n        handler 0,\n          mtime: new Date\n          atime: new Date\n          ctime: new Date\n          size: 12\n          mode: 33188\n          uid: process.getuid()\n          gid: process.getgid()\n      else\n        handler 0,\n          mtime: new Date\n          atime: new Date\n          ctime: new Date\n          size: 1234\n          mode: 33188\n          uid: process.getuid()\n          gid: process.getgid()\n      # else\n      #   handler FUSE.ENOENT\n    return null\n\n  #---------------------------------------------------------------------------------------------------------\n  open: (route, flags, handler) ->\n    info \"open            #{rpr route}, #{rpr flags}\"\n    handler 0, 42\n    # 42 is an fd\n    return\n\n  #---------------------------------------------------------------------------------------------------------\n  read: ( route, fd, buf, len, pos, handler ) ->\n    info \"read            #{rpr route}, #{rpr fd}, #{rpr buf}, #{rpr len}, #{rpr pos}\"\n    relative_route  = route\n    relative_route  = \"/#{route}\" unless relative_route[ 0 ] is '/'\n    relative_route  = \".#{route}\" unless relative_route[ 0 ] is '.'\n    locator         = njs_path.resolve mount_locator, relative_route\n    # info '©jQFeh', relative_route\n    # info '©Qpb1T', mount_locator\n    # info '©zZVe3', locator\n    content = \"\"\"\n      hello world\n      from #{locator}\n      \\n\"\"\"\n    content = content.slice(pos)\n    if !content\n      return handler(0)\n    buf.write content\n    handler content.length\n"]}